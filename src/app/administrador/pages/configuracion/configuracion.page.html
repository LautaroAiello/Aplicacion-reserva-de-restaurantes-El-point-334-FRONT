<div class="form-container">
  <!-- TARJETA PRINCIPAL: DATOS Y CONFIGURACIÓN -->
  <mat-card>
    <mat-card-header>
      <div class="header-actions">
    <button mat-icon-button (click)="volver()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>Configurar mi restaurante</h1>
  </div>
    </mat-card-header>

    <mat-card-content>
      @if (cargando()) {
      <div class="spinner-container">
        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      </div>
      } @if (!cargando() && !errorMessage()) {
      <form [formGroup]="configForm" (ngSubmit)="onSubmit()">
        <!-- SECCIÓN 1: DATOS GENERALES -->
        <h3>Datos Generales</h3>

        <mat-form-field appearance="outline">
          <mat-label>Nombre del Restaurante</mat-label>
          <input matInput formControlName="nombre" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>URL Imagen de Portada</mat-label>
          <input
            matInput
            formControlName="imagenUrl"
            placeholder="https://..."
          />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="telefono" type="tel" />
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Apertura</mat-label>
            <input matInput formControlName="horarioApertura" type="time" />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Cierre</mat-label>
            <input matInput formControlName="horarioCierre" type="time" />
          </mat-form-field>
        </div>

        <hr />

        <!-- SECCIÓN 2: PREFERENCIAS DE RESERVA -->
        <h3 formGroupName="configuracion">Preferencias de Reserva</h3>
        <div formGroupName="configuracion">
          <div class="form-row">
            <!-- SELECT 1: Anticipación -->
            <mat-form-field appearance="outline">
              <mat-label>Anticipación Mínima</mat-label>
              <mat-select formControlName="tiempoAnticipacionHoras">
                @for (horas of opcionesHoras; track horas) {
                <mat-option [value]="horas">{{ horas }} horas antes</mat-option>
                }
              </mat-select>
              <mat-hint>Tiempo requerido antes de reservar</mat-hint>
            </mat-form-field>

            <!-- SELECT 2: Personas -->
            <mat-form-field appearance="outline">
              <mat-label>Mín. Personas (Evento Largo)</mat-label>
              <mat-select formControlName="minPersonasEventoLargo">
                @for (personas of opcionesPersonas; track personas) {
                <mat-option [value]="personas"
                  >{{ personas }} personas</mat-option
                >
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <hr />

        <!-- SECCIÓN 3: DIRECCIÓN -->
        <h3 formGroupName="direccion">Dirección</h3>
        <div formGroupName="direccion">
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Calle</mat-label>
              <input matInput formControlName="calle" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Número</mat-label>
              <input matInput formControlName="numero" />
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Ciudad</mat-label>
              <input matInput formControlName="ciudad" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Provincia</mat-label>
              <input matInput formControlName="provincia" />
            </mat-form-field>
          </div>
          <h4>Ubicación en el Mapa</h4>
          <p class="map-help">
            <mat-icon>help_outline</mat-icon>
            Para obtener estos datos: Ve a Google Maps, haz <b>clic derecho</b> en la ubicación de tu local y copia los números (Ej: -31.63, -60.70).
          </p>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Latitud</mat-label>
              <input matInput type="number" formControlName="latitud" placeholder="-31.633...">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Longitud</mat-label>
              <input matInput type="number" formControlName="longitud" placeholder="-60.700...">
            </mat-form-field>
          </div>
          
          <!-- Botón para probar la ubicación (abre una pestaña nueva) -->
          @if (configForm.get('direccion.latitud')?.value && configForm.get('direccion.longitud')?.value) {
            <div class="map-preview-link">
              <a mat-button color="accent" 
                 [href]="'https://www.google.com/maps/search/?api=1&query=' + configForm.get('direccion.latitud')?.value + ',' + configForm.get('direccion.longitud')?.value" 
                 target="_blank">
                <mat-icon>map</mat-icon> Probar ubicación en Google Maps
              </a>
            </div>
          }
        </div>

        @if (errorMessage()) {
        <div class="error-message">{{ errorMessage() }}</div>
        }

        <div class="actions">
          <button
            mat-flat-button
            color="primary"
            type="submit"
            [disabled]="configForm.invalid || cargando()"
          >
            Guardar Cambios
          </button>
        </div>
      </form>
      }
    </mat-card-content>
  </mat-card>

  <!-- ZONA DE PELIGRO (Eliminar Restaurante) -->
  @if (!cargando()) {
  <mat-card class="danger-zone">
    <mat-card-header>
      <mat-card-title class="danger-title">Zona de Peligro</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p>
        Eliminar este restaurante borrará todos los datos, reservas, platos y
        configuraciones permanentemente.
      </p>
      <button mat-stroked-button color="warn" (click)="onEliminarRestaurante()">
        <mat-icon>delete_forever</mat-icon>
        Eliminar Restaurante
      </button>
    </mat-card-content>
  </mat-card>
  }
</div>
