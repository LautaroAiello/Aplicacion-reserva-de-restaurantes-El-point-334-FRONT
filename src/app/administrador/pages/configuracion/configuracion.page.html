<div class="form-container">
  <mat-card>
    <mat-card-header>
      <div class="header-actions">
        <button mat-icon-button (click)="volver()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <h1>Configurar mi restaurante</h1>
      </div>
    </mat-card-header>

    <mat-card-content>
      @if (cargando()) {
      <div class="spinner-container">
        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      </div>
      } @if (!cargando() && !errorMessage()) {
      <form [formGroup]="configForm" (ngSubmit)="onSubmit()">
        
        <h3>Datos Generales</h3>
        <mat-form-field appearance="outline">
          <mat-label>Nombre del Restaurante</mat-label>
          <input matInput formControlName="nombre" />
        </mat-form-field>
        <mat-form-field appearance="outline">
            <mat-label>URL Imagen de Portada</mat-label>
            <input matInput formControlName="imagenUrl" />
        </mat-form-field>
        <mat-form-field appearance="outline">
            <mat-label>Teléfono</mat-label>
            <input matInput formControlName="telefono" type="tel" />
        </mat-form-field>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Apertura</mat-label>
                <input matInput formControlName="horarioApertura" type="time" />
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Cierre</mat-label>
                <input matInput formControlName="horarioCierre" type="time" />
            </mat-form-field>
        </div>

        <hr />

        <h3 formGroupName="configuracion">Preferencias de Reserva</h3>
        <div formGroupName="configuracion">
          
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Anticipación Mínima</mat-label>
              <mat-select formControlName="tiempoAnticipacionHoras">
                @for (horas of opcionesHoras; track horas) {
                <mat-option [value]="horas">{{ horas }} horas antes</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Mín. Personas (Evento Largo)</mat-label>
              <mat-select formControlName="minPersonasEventoLargo">
                @for (personas of opcionesPersonas; track personas) {
                <mat-option [value]="personas">{{ personas }} personas</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

          <div class="toggle-row">
            <mat-slide-toggle formControlName="mostrarPrecios" color="primary">
              Mostrar precios en la carta digital
            </mat-slide-toggle>
            <p class="toggle-hint">
              <mat-icon>info</mat-icon>
              Si desactivas esto, los clientes verán el menú sin precios.
            </p>
          </div>

        </div>

        <hr />

        <h3 formGroupName="direccion">Dirección</h3>
        <div formGroupName="direccion">
            <div class="form-row">
                <mat-form-field appearance="outline">
                    <mat-label>Calle</mat-label>
                    <input matInput formControlName="calle" />
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Número</mat-label>
                    <input matInput formControlName="numero" />
                </mat-form-field>
            </div>
            <div class="form-row">
                <mat-form-field appearance="outline">
                    <mat-label>Ciudad</mat-label>
                    <input matInput formControlName="ciudad" />
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Provincia</mat-label>
                    <input matInput formControlName="provincia" />
                </mat-form-field>
            </div>
            
            <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Latitud</mat-label>
                  <input matInput type="number" formControlName="latitud">
                </mat-form-field>
    
                <mat-form-field appearance="outline">
                  <mat-label>Longitud</mat-label>
                  <input matInput type="number" formControlName="longitud">
                </mat-form-field>
            </div>
        </div>

        @if (errorMessage()) {
        <div class="error-message">{{ errorMessage() }}</div>
        }

        <div class="actions">
          <button
            mat-flat-button
            color="primary"
            type="submit"
            [disabled]="configForm.invalid || cargando()"
          >
            Guardar Cambios
          </button>
        </div>
      </form>
      }
    </mat-card-content>
  </mat-card>

  </div>